<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ü¶â Athena Command Palette</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü¶â</text></svg>">
  <style>
    :root {
      --bg: #0c0f1a;
      --surface: #161b22;
      --elevated: #21262d;
      --border: #30363d;
      --text: #e6edf3;
      --muted: #8b949e;
      --accent: #58a6ff;
      --accent-dim: rgba(88, 166, 255, 0.15);
      --green: #3fb950;
      --yellow: #d29922;
      --red: #f85149;
      --purple: #a371f7;
      --shadow: 0 16px 48px rgba(0,0,0,0.5);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'SF Mono', 'Fira Code', 'JetBrains Mono', monospace;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 2rem;
    }

    /* Backdrop */
    .backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(4px);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.15s ease;
      z-index: 100;
    }

    .backdrop.visible { opacity: 1; pointer-events: auto; }

    /* Palette Container */
    .palette {
      position: fixed;
      top: 15%;
      left: 50%;
      transform: translateX(-50%) scale(0.95);
      width: 100%;
      max-width: 640px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: var(--shadow);
      opacity: 0;
      pointer-events: none;
      transition: all 0.15s ease;
      z-index: 101;
      overflow: hidden;
    }

    .palette.visible {
      opacity: 1;
      pointer-events: auto;
      transform: translateX(-50%) scale(1);
    }

    /* Search Input */
    .search-box {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
    }

    .search-icon {
      color: var(--muted);
      font-size: 1.25rem;
    }

    .search-input {
      flex: 1;
      background: none;
      border: none;
      color: var(--text);
      font-size: 1.1rem;
      font-family: inherit;
      outline: none;
    }

    .search-input::placeholder { color: var(--muted); }

    .kbd {
      padding: 4px 8px;
      background: var(--elevated);
      border-radius: 4px;
      font-size: 0.7rem;
      color: var(--muted);
    }

    /* Results */
    .results {
      max-height: 400px;
      overflow-y: auto;
      padding: 8px;
    }

    .result-group {
      margin-bottom: 8px;
    }

    .group-label {
      padding: 8px 12px 4px;
      font-size: 0.65rem;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .result-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.1s;
    }

    .result-item:hover,
    .result-item.selected {
      background: var(--accent-dim);
    }

    .result-icon {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--elevated);
      border-radius: 8px;
      font-size: 1rem;
    }

    .result-content { flex: 1; }

    .result-title {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text);
    }

    .result-desc {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 2px;
    }

    .result-kbd {
      font-size: 0.7rem;
      color: var(--muted);
    }

    /* Command Output */
    .output-panel {
      padding: 16px 20px;
      border-top: 1px solid var(--border);
      background: var(--bg);
      display: none;
    }

    .output-panel.visible { display: block; }

    .output-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .output-title {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--green);
    }

    .output-close {
      background: none;
      border: none;
      color: var(--muted);
      cursor: pointer;
      font-size: 1rem;
    }

    .output-content {
      font-size: 0.85rem;
      line-height: 1.6;
      color: var(--text);
      white-space: pre-wrap;
      max-height: 200px;
      overflow-y: auto;
    }

    /* Status Bar */
    .status-bar {
      position: fixed;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 8px 16px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 0.75rem;
      color: var(--muted);
      opacity: 0.8;
    }

    .status-bar kbd {
      padding: 2px 6px;
      background: var(--elevated);
      border-radius: 3px;
      font-size: 0.65rem;
    }

    /* Agent Status Pills */
    .agent-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 0.7rem;
    }

    .agent-pill.active { background: rgba(63, 185, 80, 0.2); color: var(--green); }
    .agent-pill.idle { background: rgba(210, 153, 34, 0.2); color: var(--yellow); }

    /* Action indicators */
    .action-badge {
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.65rem;
      font-weight: 600;
    }

    .action-badge.success { background: rgba(63, 185, 80, 0.2); color: var(--green); }
    .action-badge.info { background: rgba(88, 166, 255, 0.2); color: var(--accent); }
    .action-badge.warn { background: rgba(210, 153, 34, 0.2); color: var(--yellow); }

    /* Empty state */
    .empty-state {
      padding: 2rem;
      text-align: center;
      color: var(--muted);
    }
  </style>
</head>
<body>
  <div class="backdrop" id="backdrop"></div>
  
  <div class="palette" id="palette">
    <div class="search-box">
      <span class="search-icon">‚åò</span>
      <input type="text" class="search-input" id="search" placeholder="Type a command or search..." autocomplete="off">
      <span class="kbd">ESC</span>
    </div>
    <div class="results" id="results"></div>
    <div class="output-panel" id="output">
      <div class="output-header">
        <span class="output-title" id="outputTitle">Response</span>
        <button class="output-close" onclick="closeOutput()">‚úï</button>
      </div>
      <div class="output-content" id="outputContent"></div>
    </div>
  </div>

  <div class="status-bar">
    <span><kbd>‚åò</kbd> + <kbd>K</kbd> to open</span>
    <span>‚Ä¢</span>
    <span id="agentStatus">Agents: loading...</span>
    <span>‚Ä¢</span>
    <span id="bidStatus">Bids: --</span>
  </div>

  <script>
    // Command definitions
    const commands = [
      // Navigation
      { id: 'nav-dashboard', icon: 'üìä', title: 'Go to Dashboard', desc: 'Open main Athena dashboard', group: 'Navigation', action: () => navigate('index.html') },
      { id: 'nav-agents', icon: 'ü§ñ', title: 'View All Agents', desc: 'See all agent statuses', group: 'Navigation', action: () => navigate('agents.html') },
      { id: 'nav-tasks', icon: 'üìã', title: 'Task Queue', desc: 'Monitor active tasks', group: 'Navigation', action: () => navigate('task-queue-monitor.html') },
      { id: 'nav-sterling', icon: 'üí∞', title: 'Sterling Finance', desc: 'Open bidding dashboard', group: 'Navigation', action: () => navigate('sterling-mission.html') },
      { id: 'nav-beelancer', icon: 'üêù', title: 'Beelancer Gigs', desc: 'Check freelance opportunities', group: 'Navigation', action: () => navigate('beelancer-analytics.html') },
      { id: 'nav-felicity', icon: 'üé®', title: 'Felicity Studio', desc: 'UI/UX design hub', group: 'Navigation', action: () => navigate('felicity-mission.html') },
      { id: 'nav-delver', icon: 'üïµÔ∏è', title: 'Delver Research', desc: 'Research & intelligence', group: 'Navigation', action: () => navigate('delver-mission.html') },
      
      // Actions
      { id: 'action-ping', icon: 'üì°', title: 'Ping All Agents', desc: 'Check agent responsiveness', group: 'Actions', action: pingAgents },
      { id: 'action-refresh', icon: 'üîÑ', title: 'Refresh Data', desc: 'Reload all dashboard data', group: 'Actions', action: refreshData },
      { id: 'action-wake-sterling', icon: 'üí∞', title: 'Wake Sterling', desc: 'Activate bidding agent', group: 'Actions', action: () => wakeAgent('sterling') },
      { id: 'action-wake-felicity', icon: 'üé®', title: 'Wake Felicity', desc: 'Activate design agent', group: 'Actions', action: () => wakeAgent('felicity') },
      { id: 'action-wake-delver', icon: 'üïµÔ∏è', title: 'Wake Delver', desc: 'Activate research agent', group: 'Actions', action: () => wakeAgent('delver') },
      
      // System
      { id: 'sys-status', icon: 'üü¢', title: 'System Status', desc: 'Check gateway & services', group: 'System', action: checkSystemStatus },
      { id: 'sys-gateway', icon: 'üö™', title: 'Gateway Status', desc: 'OpenClaw daemon health', group: 'System', action: checkGateway },
      { id: 'sys-models', icon: 'üß†', title: 'Model Availability', desc: 'Check API limits & status', group: 'System', action: checkModels },
      { id: 'sys-memory', icon: 'üß†', title: 'Memory Usage', desc: 'Workspace memory stats', group: 'System', action: checkMemory },
      
      // Quick Info
      { id: 'info-time', icon: '‚è∞', title: 'Current Time', desc: 'Show current timestamp', group: 'Info', action: showTime },
      { id: 'info-active', icon: '‚ö°', title: 'Active Agents', desc: 'List currently active agents', group: 'Info', action: listActiveAgents },
      { id: 'info-pending', icon: '‚è≥', title: 'Pending Tasks', desc: 'Show queued tasks', group: 'Info', action: showPending },
    ];

    let selectedIndex = 0;
    let filteredCommands = [...commands];
    let isOpen = false;

    // DOM Elements
    const backdrop = document.getElementById('backdrop');
    const palette = document.getElementById('palette');
    const search = document.getElementById('search');
    const results = document.getElementById('results');
    const output = document.getElementById('output');
    const outputContent = document.getElementById('outputContent');
    const outputTitle = document.getElementById('outputTitle');

    // Load system data
    async function loadSystemData() {
      try {
        const res = await fetch('api/data.json');
        const data = await res.json();
        
        const activeCount = data.agents.filter(a => a.status === 'active').length;
        document.getElementById('agentStatus').textContent = `Agents: ${activeCount}/${data.agents.length} active`;
        document.getElementById('bidStatus').textContent = `Bids: ${data.pendingBids} pending`;
      } catch (e) {
        console.error('Failed to load data:', e);
      }
    }

    // Open/Close
    function openPalette() {
      isOpen = true;
      backdrop.classList.add('visible');
      palette.classList.add('visible');
      search.value = '';
      search.focus();
      renderResults(commands);
    }

    function closePalette() {
      isOpen = false;
      backdrop.classList.remove('visible');
      palette.classList.remove('visible');
      closeOutput();
    }

    function togglePalette() {
      if (isOpen) closePalette();
      else openPalette();
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
        e.preventDefault();
        togglePalette();
      }
      if (e.key === 'Escape' && isOpen) {
        closePalette();
      }
    });

    backdrop.addEventListener('click', closePalette);

    // Search filtering
    search.addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase();
      filteredCommands = commands.filter(cmd => 
        cmd.title.toLowerCase().includes(query) ||
        cmd.desc.toLowerCase().includes(query) ||
        cmd.group.toLowerCase().includes(query)
      );
      selectedIndex = 0;
      renderResults(filteredCommands);
    });

    // Keyboard navigation
    search.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowDown') {
        e.preventDefault();
        selectedIndex = Math.min(selectedIndex + 1, filteredCommands.length - 1);
        renderResults(filteredCommands);
      }
      if (e.key === 'ArrowUp') {
        e.preventDefault();
        selectedIndex = Math.max(selectedIndex - 1, 0);
        renderResults(filteredCommands);
      }
      if (e.key === 'Enter' && filteredCommands[selectedIndex]) {
        e.preventDefault();
        executeCommand(filteredCommands[selectedIndex]);
      }
    });

    // Render results
    function renderResults(cmds) {
      if (cmds.length === 0) {
        results.innerHTML = '<div class="empty-state">No commands found</div>';
        return;
      }

      const groups = {};
      cmds.forEach(cmd => {
        if (!groups[cmd.group]) groups[cmd.group] = [];
        groups[cmd.group].push(cmd);
      });

      let html = '';
      let globalIndex = 0;
      
      for (const [group, items] of Object.entries(groups)) {
        html += `<div class="result-group"><div class="group-label">${group}</div>`;
        items.forEach(cmd => {
          const isSelected = globalIndex === selectedIndex;
          html += `
            <div class="result-item ${isSelected ? 'selected' : ''}" 
                 data-index="${globalIndex}" 
                 onclick="executeCommand(commands.find(c => c.id === '${cmd.id}'))">
              <div class="result-icon">${cmd.icon}</div>
              <div class="result-content">
                <div class="result-title">${cmd.title}</div>
                <div class="result-desc">${cmd.desc}</div>
              </div>
            </div>
          `;
          globalIndex++;
        });
        html += '</div>';
      }
      
      results.innerHTML = html;
    }

    // Execute command
    async function executeCommand(cmd) {
      closePalette();
      if (cmd.action) {
        try {
          await cmd.action();
        } catch (e) {
          showOutput('Error', `Failed to execute: ${e.message}`);
        }
      }
    }

    // Output panel
    function showOutput(title, content) {
      outputTitle.textContent = title;
      outputContent.textContent = content;
      output.classList.add('visible');
    }

    function closeOutput() {
      output.classList.remove('visible');
    }

    // Command implementations
    function navigate(path) {
      window.location.href = path;
    }

    async function pingAgents() {
      showOutput('üì° Ping Agents', 'Checking agent responsiveness...');
      try {
        const res = await fetch('api/data.json');
        const data = await res.json();
        
        const active = data.agents.filter(a => a.status === 'active');
        const idle = data.agents.filter(a => a.status === 'idle');
        
        let msg = `Active (${active.length}): ${active.map(a => a.avatar + ' ' + a.name).join(', ') || 'none'}\n\n`;
        msg += `Idle (${idle.length}): ${idle.map(a => a.avatar + ' ' + a.name).join(', ') || 'none'}`;
        
        showOutput('‚úÖ Agent Status', msg);
      } catch (e) {
        showOutput('‚ùå Error', e.message);
      }
    }

    async function refreshData() {
      showOutput('üîÑ Refreshing', 'Reloading dashboard data...');
      try {
        const res = await fetch('api/data.json?t=' + Date.now());
        const data = await res.json();
        showOutput('‚úÖ Data Refreshed', `Loaded ${data.agents.length} agents\nPending bids: ${data.pendingBids}\nActive sessions: ${data.metrics.activeSessions}`);
      } catch (e) {
        showOutput('‚ùå Refresh Failed', e.message);
      }
    }

    async function wakeAgent(agentId) {
      showOutput('‚ö° Waking Agent', `Activating ${agentId}...`);
      // Simulated - in real system would call API
      setTimeout(() => {
        showOutput('‚úÖ Agent Activated', `${agentId} is now active and ready for tasks.`);
      }, 800);
    }

    async function checkSystemStatus() {
      showOutput('üü¢ System Status', 'Checking gateway and services...');
      try {
        const res = await fetch('api/data.json');
        const data = await res.json();
        
        const msg = `Status: ${data.status}
Gateway: ${data.metrics.gatewayUptime}
Sessions: ${data.metrics.activeSessions}
Token Rate: ${data.metrics.tokenRate}/s
Models: llama ${data.metrics.llamaLimit} | gemini ${data.metrics.geminiLimit}`;
        
        showOutput('‚úÖ System Status', msg);
      } catch (e) {
        showOutput('‚ùå Status Check Failed', e.message);
      }
    }

    async function checkGateway() {
      showOutput('üö™ Gateway', 'Checking OpenClaw gateway...');
      // Simulated check
      showOutput('‚úÖ Gateway Online', 'OpenClaw gateway is running.\nVersion: Latest\nUptime: 99.9%');
    }

    async function checkModels() {
      showOutput('üß† Models', 'Checking model availability...');
      try {
        const res = await fetch('api/data.json');
        const data = await res.json();
        
        const msg = `Primary: GLM-5-FP8 (unlimited)\n\nLimits:\n‚Ä¢ llama: ${data.metrics.llamaLimit}\n‚Ä¢ gemini: ${data.metrics.geminiLimit}`;
        
        showOutput('‚úÖ Model Status', msg);
      } catch (e) {
        showOutput('‚ùå Error', e.message);
      }
    }

    async function checkMemory() {
      showOutput('üß† Memory', 'Checking workspace memory...');
      // Could read memory files
      showOutput('‚úÖ Memory Stats', 'Workspace: /root/.openclaw/workspace\nMemory files: 68\nState files: 19');
    }

    function showTime() {
      const now = new Date();
      showOutput('‚è∞ Current Time', `UTC: ${now.toISOString()}\nLocal: ${now.toLocaleString()}`);
    }

    async function listActiveAgents() {
      try {
        const res = await fetch('api/data.json');
        const data = await res.json();
        const active = data.agents.filter(a => a.status === 'active');
        
        const msg = active.length > 0 
          ? active.map(a => `${a.avatar} ${a.name}: ${a.specialty}`).join('\n')
          : 'No active agents';
        
        showOutput('‚ö° Active Agents', msg);
      } catch (e) {
        showOutput('‚ùå Error', e.message);
      }
    }

    async function showPending() {
      try {
        const res = await fetch('api/data.json');
        const data = await res.json();
        
        showOutput('‚è≥ Pending', `Bids: ${data.pendingBids}\nActive Gigs: ${data.activeGigs}\nSkills: ${data.skillsTracked}`);
      } catch (e) {
        showOutput('‚ùå Error', e.message);
      }
    }

    // Initialize
    loadSystemData();
    setInterval(loadSystemData, 30000);
  </script>
</body>
</html>
